{#
    Copyright (c) 2023 - 2023, Oracle and/or its affiliates. All rights reserved.
    Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl/
#}

{%- import "helper_macros.j2" as macros -%}

{%- extends "base_template.html" -%}

{#
    This section is where we fill in the blocks defined in base_template.html.
    Note that the input context dictionary will have the format:
        {data = <data_from_html_reporter}
#}

{% block timestamps %}
{{ metadata.timestamps | indent(12, first=true) }}
{% endblock%}

{% block content %}
    {% if target %}
    {#
        Display the related section only when the target information is available :
            - Target information
            - Provenance summary
            - Check report
    #}
    <div class="table_caption">Target information</div>
    {{ macros.render_target_info_table(target.info) | indent(4) }}

    <div class='space_divider'></div>

    <div class="table_caption">Provenance summary</div>
    <div id= "prov_justification">
        {% if target.provenances.is_inferred == true %}
        Could not find a provenance for this repository. Below is what Macaron has inferred.
        {% else %}
        This is the provenance found for this repository.
        {% endif %}
    </div>

    <button class="fancy-button" onclick="expandAll()">Expand All</button>
    <button class="fancy-button" onclick="collapseAll()">Collapse All</button>
    {{ macros.render_tree_view_nested_list(target.provenances.content) | indent(4) }}

    <div class='space_divider'></div>

    <div class="table_caption">Reports for Macaron checks</div>
    {{ macros.render_checks_report(target.checks.results) | indent(4) }}

    {% else %}
    {#
        TODO: design what to display if the target is empty.
    #}
    <div id= "prov_justification">Empty main target </div>

    {% endif %}

    <div class='space_divider'></div>

    {#
        Display the dependencies data if it's available:
            - The total number of dependencies and unique repositories include in the analysis
            - Dependency results (The number of dependencies pass each check)
            - The status for each dependency
    #}
    {% if dependencies.analyzed_deps != 0 %}
    <div class="table_caption" id="deps_result_title">Dependency results</div>
    <div class="table_sub_caption">
    {{ dependencies.analyzed_deps }} dependencies that map to {{ dependencies.unique_dep_repos }} unique repositories have been successfully analyzed.
    </div>
    {{ macros.render_dep_summary(dependencies.checks_summary) | indent(4) }}

    <div class="space_divider"></div>

    {{ macros.render_dep_status(dependencies.dep_status) | indent(4) }}
    {% endif %}
{% endblock %}
